| Tool(s) | Description | Calling API (inputs) | Output description | Internal workings | Implementation |
| --- | --- | --- | --- | --- | --- |
| `shell`, `local_shell`, `container.exec` | Run arbitrary commands by passing an explicit argv so Codex executes inside its sandboxed shell or a local-shell payload. | Function tool named `shell`; required `command: string[]`, optional `workdir`, `timeout_ms`, `with_escalated_permissions`, `justification`. `local_shell` uses the same shape but arrives as a `ToolPayload::LocalShell`. (`codex-rs/core/src/tools/spec.rs:267-328`) | `ToolOutput::Function` containing aggregated stdout/stderr plus structured command metadata; commands stream intermediate commandExecution events with approval hooks and apply-patch delegation when needed. (`codex-rs/core/src/tools/handlers/shell.rs:96-205`) | Handler builds `ExecParams`, enforces approval policy (rejects escalations outside `OnRequest`), and runs via `ShellRuntime`/`ToolOrchestrator`, so sandboxing, env filtering, and diff tracking happen centrally. (`codex-rs/core/src/tools/handlers/shell.rs:31-205`) | `codex-rs/core/src/tools/spec.rs`, `codex-rs/core/src/tools/handlers/shell.rs` |
| `shell_command` | Convenience wrapper that lets the model submit a single string interpreted by the user’s login shell (bash/pwsh). | Function tool named `shell_command`; required `command: string`, optional `workdir`, `timeout_ms`, `with_escalated_permissions`, `justification`. (`codex-rs/core/src/tools/spec.rs:330-392`) | Same command-execution events/output as `shell`, but the handler injects the user’s shell binary/flags before running. | `ShellCommandHandler` rewrites the string using `session.user_shell()`/`derive_exec_args`, then reuses `ShellHandler::run_exec_like`, so login-shell behavior is honored while approvals/sandbox still apply. (`codex-rs/core/src/tools/handlers/shell.rs:49-187`) | `codex-rs/core/src/tools/spec.rs`, `codex-rs/core/src/tools/handlers/shell.rs` |
| `exec_command` | Unified Exec PTY tool for long-lived interactive sessions (REPLs, prompts). | Function tool named `exec_command`; JSON fields include `cmd`, optional `workdir`, `shell`, `login`, `yield_time_ms`, `max_output_tokens`, `with_escalated_permissions`, `justification`. (`codex-rs/core/src/tools/spec.rs:142-219`) | Returns inline output or a session id, plus streaming ExecCommandOutputDelta events. | `UnifiedExecHandler` parses args, resolves shell path, enforces approval policies, and uses `UnifiedExecSessionManager` to drive PTYs with begin/end telemetry. (`codex-rs/core/src/tools/handlers/unified_exec.rs:26-200`) | `codex-rs/core/src/tools/spec.rs`, `codex-rs/core/src/tools/handlers/unified_exec.rs` |
| `write_stdin` | Companion tool that writes keystrokes to an existing unified exec session. | Function tool named `write_stdin`; required `session_id`, optional `chars`, `yield_time_ms`, `max_output_tokens`. (`codex-rs/core/src/tools/spec.rs:220-265`) | Returns the latest stdout/stderr chunk and continues streaming ExecCommandOutputDelta events. | Handled by `UnifiedExecHandler`, which forwards payloads to `UnifiedExecSessionManager::write_stdin`, preserving throttling/token limits. (`codex-rs/core/src/tools/handlers/unified_exec.rs:111-207`) | `codex-rs/core/src/tools/spec.rs`, `codex-rs/core/src/tools/handlers/unified_exec.rs` |
| `apply_patch` (freeform / JSON) | Safe file-editing tool using Codex’s diff envelope. | Freeform grammar tool or JSON function tool with `input` string containing the patch. (`codex-rs/core/src/tools/handlers/apply_patch.rs:167-220`) | Emits `fileChange` items with diff summaries; fails fast on malformed patches. | Handler re-parses via `codex_apply_patch::maybe_parse_apply_patch_verified`, computes approval metadata, and runs `ApplyPatchRuntime` inside the sandbox. (`codex-rs/core/src/tools/handlers/apply_patch.rs:1-158`) | `codex-rs/core/src/tools/handlers/apply_patch.rs` |
| `update_plan` | Structured plan documentation channel for the agent. | Function tool `update_plan`; required `plan` array of `{step,status}`, optional `explanation`. (`codex-rs/core/src/tools/handlers/plan.rs:20-60`) | Returns “Plan updated” and triggers `EventMsg::PlanUpdate` for clients. | Handler validates JSON, forwards plan updates via the session event bus, no filesystem side effects. (`codex-rs/core/src/tools/handlers/plan.rs:62-111`) | `codex-rs/core/src/tools/handlers/plan.rs` |
| `grep_files` | Ripgrep-backed search for files containing a regex. | Function tool `grep_files`; required `pattern`, optional `include`, `path`, `limit`. (`codex-rs/core/src/tools/spec.rs:480-528`) | Returns newline-separated list of matching files ordered by mtime; `success=false` when no matches. | Handler shells out to `rg --files-with-matches` with a 30s timeout, validates limits/paths, and surfaces errors if ripgrep is missing. (`codex-rs/core/src/tools/handlers/grep_files.rs:16-175`) | `codex-rs/core/src/tools/spec.rs`, `codex-rs/core/src/tools/handlers/grep_files.rs` |
| `read_file` | Reads slices or indentation-aware blocks from a file. | Function tool `read_file`; args include `file_path`, optional `offset`, `limit`, `mode`, `indentation` settings. (`codex-rs/core/src/tools/spec.rs:530-626`) | Returns numbered lines (tabs normalized) constrained by mode/settings; errors on invalid offsets/paths. | Handler enforces absolute paths, uses async IO to collect either plain slices or indentation blocks, trimming very long lines. (`codex-rs/core/src/tools/handlers/read_file.rs:1-155`) | `codex-rs/core/src/tools/spec.rs`, `codex-rs/core/src/tools/handlers/read_file.rs` |
| `list_dir` | Paginated directory tree listing with indentation/type hints. | Function tool `list_dir`; args `dir_path` (absolute), `offset` (>=1), `limit`, `depth`. (`codex-rs/core/src/tools/spec.rs:629-669`) | Outputs the absolute path plus formatted entries (one per line) and indicates when more entries exist. | Handler walks directories up to `depth`, sorts entries, enforces numeric constraints, and formats names safely. (`codex-rs/core/src/tools/handlers/list_dir.rs:19-151`) | `codex-rs/core/src/tools/spec.rs`, `codex-rs/core/src/tools/handlers/list_dir.rs` |
| `list_mcp_resources` | Enumerates MCP resources across servers (docs, APIs, etc.). | Function tool `list_mcp_resources`; optional `server`, `cursor`. (`codex-rs/core/src/tools/spec.rs:673-704`) | Returns `{server?, resources[], next_cursor?}` JSON for pagination. | Handler normalizes args, calls `Session::list_resources` (single server) or aggregates from the MCP connection manager (all servers), and emits MCP begin/end telemetry. (`codex-rs/core/src/tools/handlers/mcp_resource.rs:245-349`) | `codex-rs/core/src/tools/spec.rs`, `codex-rs/core/src/tools/handlers/mcp_resource.rs` |
| `list_mcp_resource_templates` | Lists parameterized MCP resource templates. | Function tool `list_mcp_resource_templates`; optional `server`, `cursor`. (`codex-rs/core/src/tools/spec.rs:706-735`) | Returns `{server?, resource_templates[], next_cursor?}`. | Shares the MCP resource handler, which calls `Session::list_resource_templates` or aggregates templates across servers. (`codex-rs/core/src/tools/handlers/mcp_resource.rs:352-430`) | `codex-rs/core/src/tools/spec.rs`, `codex-rs/core/src/tools/handlers/mcp_resource.rs` |
| `read_mcp_resource` | Fetches the contents of a specific MCP resource URI. | Function tool `read_mcp_resource`; required `server`, `uri`. (`codex-rs/core/src/tools/spec.rs:739-769`) | Returns serialized `ReadResourceResult` with content blocks, MIME hints, server name, and URI. | Handler calls `Session::read_resource`, emits MCP telemetry, and serializes the result for Responses API consumption. (`codex-rs/core/src/tools/handlers/mcp_resource.rs:358-430`) | `codex-rs/core/src/tools/spec.rs`, `codex-rs/core/src/tools/handlers/mcp_resource.rs` |
| MCP passthrough (`<server>/<tool>`) | Any custom MCP tool exposed by configured servers (Figma, Playwright, etc.). | Exposed automatically when Codex lists MCP tools; arguments are defined by each server’s schema. (`codex-rs/core/src/tools/spec.rs:1098-1104`) | Returns either `ToolOutput::Mcp` or a converted function output, mirroring the MCP server’s response. | `McpHandler` unwraps `ToolPayload::Mcp`, calls `handle_mcp_tool_call`, emits begin/end events, and forwards raw MCP results back to the model. (`codex-rs/core/src/tools/handlers/mcp.rs:11-74`) | `codex-rs/core/src/tools/spec.rs`, `codex-rs/core/src/tools/handlers/mcp.rs` |
| `view_image` | Attaches a local screenshot/diagram into the conversation context. | Function tool `view_image`; required `path`. (`codex-rs/core/src/tools/spec.rs:394-415`) | Injects `UserInput::LocalImage`, emits `ViewImageToolCallEvent`, and returns “attached local image path”. | Handler resolves/validates the path, calls `session.inject_input`, and logs the event for UI consumption. (`codex-rs/core/src/tools/handlers/view_image.rs:15-90`) | `codex-rs/core/src/tools/spec.rs`, `codex-rs/core/src/tools/handlers/view_image.rs` |
| `test_sync_tool` | Internal synchronization helper for Codex integration tests. | Function tool `test_sync_tool`; optional `sleep_before_ms`, `sleep_after_ms`, `barrier` (`id`, `participants`, optional `timeout_ms`). (`codex-rs/core/src/tools/spec.rs:418-478`) | Returns “ok” after optional sleeps or barrier waits; errors if barrier settings are invalid or time out. | Handler manages `Barrier` instances in a global map, sleeps before/after as requested, and cleans up when the last participant proceeds. (`codex-rs/core/src/tools/handlers/test_sync.rs:19-158`) | `codex-rs/core/src/tools/spec.rs`, `codex-rs/core/src/tools/handlers/test_sync.rs` |
| `web_search` | First-party OpenAI web search tool (opt-in) for fetching fresh info. | Declared as `{ "type": "web_search" }` (no params) when `Feature::WebSearchRequest`/`tools.web_search` is enabled. (`codex-rs/core/src/tools/spec.rs:36-83`, `codex-rs/core/src/tools/spec.rs:1089-1090`) | Responses API emits `WebSearchCall` items (search/open/find actions) that Codex records as `TurnItem::WebSearch`. | Codex advertises the tool to OpenAI; when the model triggers web search, upstream services perform the browse, and Codex maps the resulting items/events into its timeline. (`codex-rs/core/src/event_mapping.rs:114-121`, `codex-rs/core/src/client.rs:688-712`) | `codex-rs/core/src/tools/spec.rs`, `codex-rs/core/src/event_mapping.rs`, `codex-rs/core/src/client.rs` |
